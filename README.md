https://github.com/Tchernik0ff/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Заказ

```
export interface IOrder {
  payment: string;
  email: string;
  phone: string;
  addres: string;
  total: number;
  items: string[];
}
```

Товары

```
export interface IProductsData {
  total: number;
  products: IProduct[];
  preview: string | null;
}
```

Корзина

```
export interface ICart {
  items: TProductInCart[];
  total: number;
}
```

Товар на главной, без подробного описания

```
export type TProductPreview = Pick<IProduct, 'id' | 'image' | 'title' | 'category' | 'price'>
```

Товар в корзине

```
export type TProductInCart = Pick<IProduct, 'id' | 'title' | 'price'>
```

Сумма списания в модалке успешного заказа

```
export type TOrderTotalSummary = Pick<IOrder, 'total'>
```

## Архитектура приложения 
Код приложения разделен на слои согласно парадигме MVP:\
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:\
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием  третьего параметра при вызове.

#### Класс EventEmitter
Броке событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Основные методы реализуемые классом описаны интерфейсом `IEvents`:\
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:\
- _products: IProduct[] - массив объектов карточек товара
- _preview: string | null - id карточки товара выбранной для просмотра в модальном окне
- events: IEvents - Экземпляр класса `EventEmitter`

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getProductCard(productId: string): IProduct - возвращает карточку товара по ее id
- addToCart(productId: string): void - добавляет товар с соответствующим id в корзину
- а так же геттеры для получения данных из полей класса 

#### Класс CartData 
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:\
- items: TProductInCard[] - Массив объектов товара в корзине
- total: number - Общая стоимость
- events: IEvents - Экземпляр класса `EventEmitter`
- cartCounter: HTMLElement - Элемент счетчика корзины

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItem(product: IProduct): void - добалвяет товар в массив товаров корзины
- removeItem(productId: string): void - удаляет товар по id из массива товаров к корзине
- calculateTotalPrice(): number - рассчитывает общую стоимость товаров в корзине
- updateCartCounter(): number - возвращает длинну массива товаров
- а так же геттер для получения данных 

#### Класс PaymentForm
Класс отвечает за хранение и логику работы с формой оплаты.\
Конструктор класса принимает инстант брокера событий и данные заказа\
В полях класса хранятся следующие данные:\
- payment: - Способ оплаты.
- phone: - Номер телефона.
- address: - Адрес доставки.
- events: IEvents - экземпляр класса `EventEmitter`

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- validateForm(): boolean - Валидация полей формы
- а так же геттеры для получения данных из полей класса 

#### Класс ContactDetailsForm
Класс отвечает за хранение и логику работы с формой контактных данных.
В полях класса хранятся следующие данные:\
- email: - Способ оплаты.
- phone: - Номер телефона.
- events: IEvents - экземпляр класса `EventEmitter`

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- validateForm(): boolean - Валидация полей формы
- а так же геттеры для получения данных из полей класса 

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM - элемент) передаваемых в них данных.

#### Класс Component
Абстрактный класс являектся родительским для всех классов представления, предоставляет общие методы и свойства.

Поля класса:
- container: HTMLElement - ссылка на DOM элемент в котором будет отображаться компонент.
- events: IEvents - экземпляр класса EventEmitter для работы с событиями

Методы класса:
- render(): HTMLElement - отвечает за создание и возврат DOM элемента который будет отображаться в контейнере
- setContainer(container: HTMLElement): void - устанавливает контейнер, в который будет отображаться компонент
- setContent(): void - добавляет разметку в контейнер
- clearContent(): void - удаляет разметку из контейнера

*PS: Если я завалил работу, огромная к Вам просьба, если это возможно, хотел бы получить дополнительную итерацию чтобы разобраться все таки окончательно в документации, не хотел бы приступать к написанию кода, упуская такой важный момент.*

#### Класс MainPage
Расширяет абстрактный класс `Component` отвечает за главную страницу, содержит кнопку корзины. Принимает в конструктор  - элемент разметки  корзины и экземпляр `EventEmitter` для инициации событий нажатия пользователем на корзину.

#### Класс Modal
Расширяет абстрактный класс `Component`. Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик по оверлей и кнопку крестик для закрытия попапа. Так же есть метод `setContent` который принимает HTMLElement возвращает void, для установки содержимого в модальное окно.
- constructor(selector: string, events: IEvents) - констурктор принимает селектор, по которому в разметке будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modalContainer: HTMLElement - Содержит элемент модального окна, выбранный по селектору, переданному в конструктор.
- closeButton: HTMLButtonELement - Содержит элемент кнопки закрытия модального окна, выбранный внутри modalContainer.
- contentContainer: HTMLElement - Содержит элемент, в который будет подставляться содержимое темплейта внутри модального окна.
- events: IEvents - Брокер событий 

#### Класс BaseForm
Базовый класс для форм.
Поля класса:
- formElement: HTMLFormElement - Ссылка на элемент формы
- inputs: NodeListOf<HTMLInputElement> - Коллекция всех инпутов формы
- submitButton: HTMLButtonElement - Ссылка на кнопку сабмита 
- errorContainer: Record<string, HTMLElement> - Объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы класса:
- showError(field: string, errorMessage: string): void - Отображает ошибки
- hideError(field: string, errorMessage: string): void - Скрывает ошибки
- submit: Function - Обрабатывает отправку формы
- setValid(isValid: boolean): void - изменяет активность кнопки 


#### Класс PaymentForm
Расширяет родительский BaseForm. Предназначен для отображения формы оплаты

Поля класса:
- paymentMethod: NodeListOf<HTMLButtonElement> - коллекция кнопок оплаты


#### Класс ProductPreview
Расширяет класс Modal. Предназначен для отображения информации о товаре в модальном окне.

Поля класса:
- productTitle: HTMLElement - Элемент названия товара
- productImage: HTMLImageElement - Элемент изображения товара
- productCategory: HTMLElement - Элемент категории товара
- productPrice: HTMLElement - Элемент цены товара
- productDescription: HTMLElement - Элемент подробного описания товара
- addToCartButton: HTMLButtonElement - Кнопка "В корзину"

Методы класса:
- open(productData) - принимает в параметры объект содержащий данные товара

#### Класс CartView
Расширяет класс Modal. Предназначен для отображения содержимого корзины в модальном окне.

Поля класса: 
- itemsList: HTMLElement - Элемент списка товаров в корзине
- totalPriceElement: HTMLElement - Элемент общей стоимости
- checkoutButton: HTMLButtonElement - Кнопка "Оформить"

Методы класса:
- renderCartItems(items: []): void - Отображает товары из массива добавленных в корзину
- updateTotalPrice(total: number): void - Обновляет общую стоимость
- handleSubmit() - Функция сабмита, по идее должна сохранять список айдишников товара в корзине

#### Класс SuccessOrder
Расширяет класс Modal. Предназначен для отображения сообщения об успешном заказе в модальном окне.

Поля класса:
- descriptionElement: HTMLElement - Элемент содержащий сумму списания
- сontinueShopping: HTMLButtonElement - Кнопка "За новыми покупками!"

Методы класса:
- close(): void - Расширяет родительский метод

#### Класс ProductCard
Отвечает за отображение карточки, задавая в карточке данные наименования, изображения, категории, цены и описания. В контруктор передается DOM элемент темплейта, что позволяет при необходимости формировать карточки товара с разными вариантами верстки. В классе устанавливаются слушатели.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Методы класса:
- setData:(productData: IProduct): void - заполянет атрибуты элементов карточки товара данными
- render(): HTMLElement - метод возвращает полностью заполенную карточку товара с установленными слушателями
- геттер id - возвращает ид карточки товара

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осущствляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cartItem: changed` - изменение массива данных товаров в корзине
- `cartItemCounter: changed` - изменение данных счетчика корзины
- `product: selected` - изменение открываемой в модальном окне карточки

*События возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal: open` - открытие модального окна
- `modal: clearModal` - очистка модального окна
- `productCard: selected` - выбор карточки товара для открытия в модальном окне
- `paymentMethod: selected` - выбор метода оплаты
- `addItemToCart: addToCart` - Событие, генерируемое при добавлении товара в корзину
- `removeItemFromCart: removeFromCart` - Событие генерируемое при удалении товара из корзины
- `submitOrder: submit` - Событие генерируемое при оформлении заказа
- `finalizeOrder: submit` - Событие генерируемое при окончатльном оформлении заказа
- `form-fields: input` - изменение данных в полях форм
- `updateCartCounter: update` - изменение данных в счетчике корзины
- `payment-options: validation` - Событие сообщающее о необходимости валидации формы оплаты  
- `contacts-options: validation` - Событие сообщающее о необходимости валидации формы контактных данных
