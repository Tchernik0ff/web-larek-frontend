https://github.com/Tchernik0ff/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  selected: boolean;
}
```

Успешный заказ

```
export interface IOrderPost {
  id: string[],
  total: number;
}
```

Заказ

```
export interface IOrder {
  _payment: string;
  _email: string;
  _phone: string;
  _addres: string;
  _total: number;
  _items: string[];
}
```

Товары

```
export interface IProductsData {
  total?: number;
  products: IProduct[];
}
```

Корзина

```
export interface ICart {
  items: TProductInCart[];
  total: number;
}
```

Элемент корзины

```
export interface ICartItem {
  product: TProductInCart;
}
```

Товар в корзине

```
export interface TProductInCart {
  id: string,
  title: string,
  price: number | null,
  index: number
}
```

Методы апи

```
export type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

Апи

```
export interface IApi {
  baseUrl: string;
  get<T>(url: string): Promise<T>;
  post<T>(url: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

## Архитектура приложения 
Код приложения разделен на слои согласно парадигме MVP:\
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:\
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием  третьего параметра при вызове.

#### Класс EventEmitter
Броке событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Основные методы реализуемые классом описаны интерфейсом `IEvents`:\
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:\
- _products: IProduct[] - массив объектов карточек товара
- _preview: string | null - id карточки товара выбранной для просмотра в модальном окне
- events: IEvents - Экземпляр класса `EventEmitter`

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getProductCard(productId: string): IProduct - возвращает карточку товара по ее id
- а так же геттеры для получения данных из полей класса 

#### Класс CartData 
Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:\
- _items: TProductInCard[] - Массив объектов товара в корзине
- _total: number - Общая стоимость
- events: IEvents - Экземпляр класса `EventEmitter`

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItem(product: TProductInCart): void - добалвяет товар в массив товаров корзины
- removeItem(productId: string): void - удаляет товар по id из массива товаров к корзине
- resetCartData() - сбрасывает массив и сумму корзины к начальному состоянию
- updateIndex() - обновляет порядковый номер товара в корзине
- hasInCart(productId: string) - проверяет есть ли товар с данным id в корзине
- getItemIds(): string[] - метод для получения массива id товаров которые находятся в корзине
- calculateTotalPrice(): number - рассчитывает общую стоимость товаров в корзине
- updateCartCounter(): number - возвращает длинну массива товаров
- а так же геттеры для получения данных о товарах в корзине и суммы

#### Класс OrderData
Класс отвечает за хранение данных заказа.
Поля класса:\
- payment: string - метод оплаты
- email: string - email покупателя
- phone: string - телефон покупателя
- address: string - адрес
- total: number - сумма заказа
- items: string[] - массив с id оформляемых товаров

У класса есть один метод:\
- resetOrder() - сбрасывает значения полей заказа
- а так же сеттеры и геттеры для получения данных

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM - элемент) передаваемых в них данных.

#### Класс Component
Абстрактный класс являектся родительским для всех классов представления, предоставляет общие методы и свойства.

Поля класса:
- container: HTMLElement - ссылка на DOM элемент в котором будет отображаться компонент.
- events: IEvents - экземпляр класса EventEmitter для работы с событиями

Методы класса:
- render(): HTMLElement - отвечает за создание и возврат DOM элемента который будет отображаться в контейнере


#### Класс MainPage
Расширяет абстрактный класс `Component` отвечает за отображение данных главной страницы. Принимает в конструктор  - элемент разметки и экземпляр `EventEmitter` для инициации событий.

Поля класса:
- _catalog: HTMLElement - содержит элемент каталога главной страницы
- cartBtn: HTMLButtonElement - элемент кнопки корзины
- _сartCounter: HTMLElement - содержит элемент счетчика товаров корзины
- pageWrapper: HTMLElement - содержит элемент обертки

Методы класса:
- lockElement() - блокирует элемент обертки
- unlockElement() - разблокирует элемент обертки
- а так же сеттеры для установки каталога карточек товара и счетчика корзины

#### Класс Modal
Расширяет абстрактный класс `Component`. Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик по оверлей и кнопку крестик для закрытия попапа.
- constructor(selector: string, events: IEvents) - констурктор принимает селектор, по которому в разметке будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modal: HTMLElement - Содержит элемент модального окна, выбранный по селектору, переданному в конструктор.
- closeBtn: HTMLButtonELement - Содержит элемент кнопки закрытия модального окна
- content: HTMLElement - Содержит элемент, в который будет подставляться содержимое темплейта внутри модального окна.

Метод класса render(data: IModal): HTMLElement - принимает объект data типа IModal

#### Класс BaseForm
Базовый абстрактный класс для форм. Расширяет абстрактный класс `Component`.

Поля класса:
- submitButton: HTMLButtonElement - элемент кнопку сабмита
- errElement: HTMLElement - элемент в который размещаются ошибки форм

Методы класса:
- getInputElements(): HTMLInputelement[] - абстрактный метод для получения инпутов формы
- getInvalidInputs(): HTMLInputElement[] - метод для получения инпутов которые пусты
- getValidInputs(): HTMLInputElement[] - метод для получения валидных инпутов
- validateFormInputs(): boolean - метод для проверки, не пуст ли инпут
- handleValidation() - метод валидации формы
- showError() - отображает ошибки и устанавливает кастомную валидность
- hideError() - скрывает ошибки
- resetInputs() - метод для очистки содержимого инпутов
- setAwaitBtn() - метод для установки кнопки сабмита в режим "ожидания"
- clearValidation() - сброс валидации

#### Класс ContactsForm
Расширяет родительский BaseForm. Предназначен для отображения формы контактных данных

Поля класса:
- emailInput: HTMLInputElement - инпут для ввода эмейла
- phoneInput: HTMLInputElement - инпут для ввода телефона
- submitBtn: HTMLButtonElement - элемент кнопки сабмита

Метод getInputElements(): HTMLInputElement[] - возвращает два инпута формы

#### Класс PaymentForm
Расширяет родительский BaseForm. Предназначен для отображения формы оплаты

Поля класса:
- onlineBtn: HTMLButtonElement - элемент кнопки оплаты "Онлайн"
- onDeliveryBtn: HTMLButtonElement - элемент кнопки оплаты "При получении"
- addresInput: HTMLInputElement - инпут адреса
- submitBtn: HTMLButtonElement - элемент кнопки сабмита

Методы класса:\
- getInputElements(): HTMLInputElement[] - метод возвращает инпут адреса
- getBtnElem(): HTMLButtonElement[] - метод возвращает кнопки оплаты формы
-  validateFormInputs(): boolean - метод переопределен для того чтобы добавить проверку выбранного метода оплаты
- validateSelection(): boolean - метод для проверки нажата ли одна из кнопок оплаты
- handkeClick(targetBtn: HTMLButtonElement) - метод для проверки, какая из кнопок нажата. Переключает активный класс на нажатую кнопку, при этом убирает активный класс с ранее нажатой кнопки.
- а так же сеттер, который сбрасывает кнопки при повторном открытии формы

#### Класс CartView
Предназначен для отображения содержимого корзины в модальном окне. Расширяет абстрактный класс `Component`.

Поля класса: 
- _itemsList: HTMLElement - элемент списка товаров в корзине
- basketBtn: HTMLButtonElement - элемент кнопки сабмита корзины
- basketPriceContainer: HTMLElement - элемент отображения суммы товаров в корзине

Методы класса:
- setButton(value: boolean) - метод деактивирующий кнопку оформления заказа
- а так же, сеттеры суммы товаров и сеттер карточек товаров

#### Класс FinalazeOrder
Предназначен для отображения сообщения об успешном заказе в модальном окне. Расширяет абстрактный класс `Component`.

Поля класса:
- totalCost: HTMLElement - сумма успешного заказа
- continiueShoppingBtn: HTMLButtonElement - кнопка для продолжения покупок
- а так же сеттер суммы заказа

#### Класс ProductCard
Расширяет абстрактный `Component` отвечает за отображение карточки, товара с разными вариантами верстки. В классе устанавливаются слушатели.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Поля класса:
- cardWrapperBtn: HTMLButtonElement 
- cardCategory: HTMLElement - элемент разметки категории карточки товара
- categoryClassList: Record<string, string> - содержит категории карточек
- cardTitle: HTMLElement - элемент разметки заголовка карточки товара
- cardImage: HTMLImageElement - элемент разметки изображения товара
- cardPrice: HTMLElement - элемент разметки цены товара
- productId: string - ид продукта
- _description: HTMLElement - элемент разметки описания товара
- buyBtn: HTMLButtonElement - элемент кнопки добавления в корзину
- removeBtn: HTMLButtonElement - элемент кнопки удаления товара 
- prodcutIndex: HTMLElement - элемент порядкового номера карточки товара

Методы класса:
- handleClick() - генерирует событие и передает карточку товара
- removeListener() - удаляет слушатель клика на карточку
- а так же сеттеры изображения, описания, заголовка, категории, порядкового номера, цены 

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осущствляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cartItem: changed` - изменение массива данных товаров в корзине

*События возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `data: loaded` - событие генерируемое при загрузке данных с сервера
- `modal: open` - открытие модального окна
- `modal: close` - закрытие модального окна
- `cart: open` - открытие корзины
- `product: selected` - выбор карточки товара для открытия в модальном окне
- `product: addToCart` - событие генерируемое при добавлении товара в корзину
- `product: removeFromCart` - событие генерируемое при выборе карточки товара
- `form: changes` - изменения в форме, нажатик кнопок, ввод в инпуты
- `firstStepForm: complete'` - событие, генерируемое при отправке первой формы
- `order: start` - событие генерируемое при старте оформления заказа
- `order: place` - событие генерируемое при оформлении заказа
- `order: final` - событие генерируемое при нажатии кнопки продолжить покупки